import{_ as s,o as n,c as a,a as e}from"./app.4690b2e6.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":3,"title":"软件介绍","slug":"软件介绍","link":"#软件介绍","children":[]},{"level":3,"title":"编写人员","slug":"编写人员","link":"#编写人员","children":[]},{"level":3,"title":"安装过程:","slug":"安装过程","link":"#安装过程","children":[]},{"level":3,"title":"配置文件","slug":"配置文件","link":"#配置文件","children":[]},{"level":3,"title":"安全优化","slug":"安全优化","link":"#安全优化","children":[]}],"relativePath":"articles/deploy/负载均衡-nginx安装.md","lastUpdated":1697780285000}'),l={name:"articles/deploy/负载均衡-nginx安装.md"},p=e(`<h3 id="软件介绍" tabindex="-1">软件介绍 <a class="header-anchor" href="#软件介绍" aria-hidden="true">#</a></h3><p>redis</p><h3 id="编写人员" tabindex="-1">编写人员 <a class="header-anchor" href="#编写人员" aria-hidden="true">#</a></h3><h4 id="特性" tabindex="-1">特性 <a class="header-anchor" href="#特性" aria-hidden="true">#</a></h4><h4 id="局限性" tabindex="-1">局限性 <a class="header-anchor" href="#局限性" aria-hidden="true">#</a></h4><h4 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-hidden="true">#</a></h4><h3 id="安装过程" tabindex="-1">安装过程: <a class="header-anchor" href="#安装过程" aria-hidden="true">#</a></h3><p>安装依赖（centos7系统使用）（在线）</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/yum.repos.d/CentOS-Base.repo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://mirrors.aliyun.com/repo/Centos-7.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/yum.repos.d/epel.repo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://mirrors.aliyun.com/repo/epel-7.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">telnet</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lsof</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gcc-c++</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">autoconf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">automake</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">openssl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">openssl-devel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>安装依赖(Centos8，OpenEuler使用)</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dnf install wget telnet lsof gcc gcc-c++ autoconf automake make openssl openssl-devel -y</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下载源码包</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">cd /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://tengine.taobao.org/download/tengine-2.3.2.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>解压</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">tar -zxvf tengine-2.3.2.tar.gz </span></span>
<span class="line"><span style="color:#A6ACCD;">cd tengine-2.3.2</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建文件夹</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/logs/nginx/</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/nginx/bin</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/nginx/conf</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>配置</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">cd /data/software/tengine-2.3.2</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure --prefix=/usr/local/nginx \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--lock-path=/usr/local/nginx/nginx.lock \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--pid-path=/usr/local/nginx/nginx.pid \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--error-log-path=/data/logs/nginx/error.log \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--http-log-path=/data/logs/nginx/access.log \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-stream \\</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>安装</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">make &amp;&amp; make install</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改环境变量,在最后增加nginx主目录，后续可以直接使用<code>nginx</code>命令进行操作</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">vi /etc/profile</span></span>
<span class="line"><span style="color:#A6ACCD;">NGX_HOME=/usr/local/nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">export PATH=$PATH:$NGX_HOME/sbin</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>开启防火墙</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=80/tcp --permanent</span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-hidden="true">#</a></h3><p>参考如下内容，修改/usr/local/nginx/conf/nginx.conf文件</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#user  nobody;</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_processes  8;</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_rlimit_nofile 204800;</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="color:#A6ACCD;">#error_log  logs/error.log  info;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#pid        logs/nginx.pid;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">events {</span></span>
<span class="line"><span style="color:#A6ACCD;">    use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;">    worker_connections  102400;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">http {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    log_format  main  &#39;$remote_user [$time_local] $http_x_Forwarded_for , $remote_addr , request: $request , status:$status ,&#39; &#39;$http_x_forwarded_for ,&#39; &#39;upstream_addr: $upstream_addr ,&#39; &#39;ups_resp_time: $upstream_response_time ,&#39; &#39;request_time: $request_time&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    access_log  /data/logs/nginx/access.log  main;</span></span>
<span class="line"><span style="color:#A6ACCD;">    error_log  /data/logs/nginx/error.log  ; </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    #代理服务端不要主要主动关闭客户端连接</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_ignore_client_abort on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    default_type  application/octet-stream;</span></span>
<span class="line"><span style="color:#A6ACCD;">    sendfile        on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server_tokens off;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    client_header_timeout 120;</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_connect_timeout 60000; </span></span>
<span class="line"><span style="color:#A6ACCD;">    keepalive_timeout 120;</span></span>
<span class="line"><span style="color:#A6ACCD;">    send_timeout 120;</span></span>
<span class="line"><span style="color:#A6ACCD;">    autoindex off;</span></span>
<span class="line"><span style="color:#A6ACCD;">    autoindex_exact_size off;</span></span>
<span class="line"><span style="color:#A6ACCD;">    autoindex_localtime on;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    #限制同一个客户端地址限制10M</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_conn_zone $binary_remote_addr zone=perip:10m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_conn_zone $server_name zone=perserver:10m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    upstream fweb-unify-portal {</span></span>
<span class="line"><span style="color:#A6ACCD;">        server 192.168.26.60:9093;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    server {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        if ( $query_string ~* &quot;union.*select.*\\(&quot; ) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;">        if ( $query_string ~* &quot;concat.*\\(&quot; ) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;">        if ($query_string ~ &quot;//|[&#39;\\&quot;]+|%27&quot;) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_conn perip 20;</span></span>
<span class="line"><span style="color:#A6ACCD;">        #限制同一个客户端每秒20个并发</span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_conn perserver 20;</span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_rate 300k;</span></span>
<span class="line"><span style="color:#A6ACCD;">        client_body_buffer_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;">        #client_header_bfuffer_size 1k;</span></span>
<span class="line"><span style="color:#A6ACCD;">        client_max_body_size 16m;</span></span>
<span class="line"><span style="color:#A6ACCD;">        large_client_header_buffers 2 1m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        listen 80;</span></span>
<span class="line"><span style="color:#A6ACCD;">        server_name localhost;</span></span>
<span class="line"><span style="color:#A6ACCD;">        keepalive_timeout 0;</span></span>
<span class="line"><span style="color:#A6ACCD;">        location /static {</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span></span>
<span class="line"><span style="color:#A6ACCD;">	        default_type  application/octet-stream;</span></span>
<span class="line"><span style="color:#A6ACCD;">	        sendfile  on;</span></span>
<span class="line"><span style="color:#A6ACCD;">	        autoindex off;</span></span>
<span class="line"><span style="color:#A6ACCD;">	        autoindex_exact_size off;</span></span>
<span class="line"><span style="color:#A6ACCD;">	        autoindex_localtime on;</span></span>
<span class="line"><span style="color:#A6ACCD;">                add_header Access-Control-Allow-Origin *;</span></span>
<span class="line"><span style="color:#A6ACCD;">            root   /data/nginx/html;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        location /fweb-unify-portal {</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_pass http://fweb-unify-portal;</span></span>
<span class="line"><span style="color:#A6ACCD;">            #public</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_set_header Host $host;</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            #for websocket</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_http_version 1.1;</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_set_header Upgrade $http_upgrade;</span></span>
<span class="line"><span style="color:#A6ACCD;">            proxy_set_header Connection &quot;upgrade&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        location ~ /\\.ht {</span></span>
<span class="line"><span style="color:#A6ACCD;">            deny all;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><h3 id="安全优化" tabindex="-1">安全优化 <a class="header-anchor" href="#安全优化" aria-hidden="true">#</a></h3><h4 id="应限制nginx-conf文件权限-建议-600" tabindex="-1">应限制nginx.conf文件权限，建议（600） <a class="header-anchor" href="#应限制nginx-conf文件权限-建议-600" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">chmod 600 /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="应限制log文件权限-建议-640" tabindex="-1">应限制log文件权限，建议（640） <a class="header-anchor" href="#应限制log文件权限-建议-640" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">chmod 640 /usr/local/nginx/logs/access.log</span></span>
<span class="line"><span style="color:#A6ACCD;">chmod 640 /usr/local/nginx/logs/error.log</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="启用自动结束会话功能-http中配置" tabindex="-1">启用自动结束会话功能 http中配置 <a class="header-anchor" href="#启用自动结束会话功能-http中配置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">client_header_timeout 90;</span></span>
<span class="line"><span style="color:#A6ACCD;">keepalive_timeout 95;</span></span>
<span class="line"><span style="color:#A6ACCD;">send_timeout 90;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="限制ngnix访问-htxx文件-按需修改" tabindex="-1">限制ngnix访问.htxx文件(按需修改) <a class="header-anchor" href="#限制ngnix访问-htxx文件-按需修改" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">location ~ /\\.ht {</span></span>
<span class="line"><span style="color:#A6ACCD;">deny all;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="配置最大连接数-http中配置" tabindex="-1">配置最大连接数 http中配置 <a class="header-anchor" href="#配置最大连接数-http中配置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">events {</span></span>
<span class="line"><span style="color:#A6ACCD;">use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;">worker_connections 10240;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="限制用户连接并发数-http中配置" tabindex="-1">限制用户连接并发数 http中配置 <a class="header-anchor" href="#限制用户连接并发数-http中配置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">http{</span></span>
<span class="line"><span style="color:#A6ACCD;">    #限制同一个客户端地址限制10M</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_conn_zone $binary_remote_addr zone=perip:10m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_conn_zone $server_name zone=perserver:10m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server{</span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_conn perip 20;</span></span>
<span class="line"><span style="color:#A6ACCD;">        #限制同一个客户端每秒20个并发</span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_conn perserver 20;</span></span>
<span class="line"><span style="color:#A6ACCD;">        #限制链接下载速率，可根据实际调整</span></span>
<span class="line"><span style="color:#A6ACCD;">        limit_rate 100M;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="隐藏客户端版本号-http中配置" tabindex="-1">隐藏客户端版本号 http中配置 <a class="header-anchor" href="#隐藏客户端版本号-http中配置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">server_tokens off;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="配置自定义缓存" tabindex="-1">配置自定义缓存 <a class="header-anchor" href="#配置自定义缓存" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">client_body_buffer_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;">#client_header_bfuffer_size 1k;</span></span>
<span class="line"><span style="color:#A6ACCD;">client_max_body_size 16m;</span></span>
<span class="line"><span style="color:#A6ACCD;">large_client_header_buffers 2 1m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="自定义错误菜单" tabindex="-1">自定义错误菜单 <a class="header-anchor" href="#自定义错误菜单" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"> error_page 400 401 402 403 404 405 408 410 412 413 414 415 500 501 502 503 504 506 /404.html;</span></span>
<span class="line"><span style="color:#A6ACCD;"> location = /404.html{</span></span>
<span class="line"><span style="color:#A6ACCD;">     root /data/nginx/html/pages/404/</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="中间件过滤敏感数据-server-中添加过滤所有请求-也可以在location中添加" tabindex="-1">中间件过滤敏感数据 server 中添加过滤所有请求，也可以在location中添加 <a class="header-anchor" href="#中间件过滤敏感数据-server-中添加过滤所有请求-也可以在location中添加" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">        if ( $query_string ~* &quot;union.*select.*\\(&quot; ) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;">        if ( $query_string ~* &quot;concat.*\\(&quot; ) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;">        if ($query_string ~ &quot;//|[&#39;\\&quot;]+|%27&quot;) { return 506; }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="设置开机启动" tabindex="-1">设置开机启动 <a class="header-anchor" href="#设置开机启动" aria-hidden="true">#</a></h4><h4 id="添加nginx-service" tabindex="-1">添加nginx.service <a class="header-anchor" href="#添加nginx-service" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rm -rf /lib/systemd/system/nginx.service</span></span>
<span class="line"><span style="color:#A6ACCD;">cat &gt;&gt; /lib/systemd/system/nginx.service &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Unit]</span></span>
<span class="line"><span style="color:#A6ACCD;">Description=nginx service</span></span>
<span class="line"><span style="color:#A6ACCD;">After=network.target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Service]</span></span>
<span class="line"><span style="color:#A6ACCD;">Type=forking</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStart=/usr/local/nginx/sbin/nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span style="color:#A6ACCD;">PrivateTmp=true</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Install]</span></span>
<span class="line"><span style="color:#A6ACCD;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="重新加载nginx服务" tabindex="-1">重新加载nginx服务 <a class="header-anchor" href="#重新加载nginx服务" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="启动nginx" tabindex="-1">启动nginx <a class="header-anchor" href="#启动nginx" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl start nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="启用nginx开机启动" tabindex="-1">启用nginx开机启动 <a class="header-anchor" href="#启用nginx开机启动" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl enable nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查看nginx状态" tabindex="-1">查看nginx状态 <a class="header-anchor" href="#查看nginx状态" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl status nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="nginx相关操作命令" tabindex="-1">nginx相关操作命令 <a class="header-anchor" href="#nginx相关操作命令" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl start nginx  #启动nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl stop nginx  #停止nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl reload nginx  #重新加载nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,62),r=[p];function i(c,o,t,b,C,d){return n(),a("div",null,r)}const m=s(l,[["render",i]]);export{A as __pageData,m as default};
