import{_ as s,o as a,c as n,a as e}from"./app.e6daa892.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":3,"title":"pmm-client客户端安装","slug":"pmm-client客户端安装","link":"#pmm-client客户端安装","children":[]},{"level":3,"title":"软件介绍","slug":"软件介绍","link":"#软件介绍","children":[]},{"level":3,"title":"编写人员","slug":"编写人员","link":"#编写人员","children":[]},{"level":3,"title":"名词解释:","slug":"名词解释","link":"#名词解释","children":[]},{"level":3,"title":"官方文档:","slug":"官方文档","link":"#官方文档","children":[]},{"level":3,"title":"安装过程:","slug":"安装过程","link":"#安装过程","children":[]}],"relativePath":"articles/deploy/服务监控-pmm-client客户端安装.md","lastUpdated":1697780285000}'),l={name:"articles/deploy/服务监控-pmm-client客户端安装.md"},p=e(`<h3 id="pmm-client客户端安装" tabindex="-1">pmm-client客户端安装 <a class="header-anchor" href="#pmm-client客户端安装" aria-hidden="true">#</a></h3><h3 id="软件介绍" tabindex="-1">软件介绍 <a class="header-anchor" href="#软件介绍" aria-hidden="true">#</a></h3><p>pmm-client</p><h3 id="编写人员" tabindex="-1">编写人员 <a class="header-anchor" href="#编写人员" aria-hidden="true">#</a></h3><h4 id="特性" tabindex="-1">特性 <a class="header-anchor" href="#特性" aria-hidden="true">#</a></h4><h4 id="局限性" tabindex="-1">局限性 <a class="header-anchor" href="#局限性" aria-hidden="true">#</a></h4><h4 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-hidden="true">#</a></h4><h3 id="名词解释" tabindex="-1">名词解释: <a class="header-anchor" href="#名词解释" aria-hidden="true">#</a></h3><h3 id="官方文档" tabindex="-1">官方文档: <a class="header-anchor" href="#官方文档" aria-hidden="true">#</a></h3><h3 id="安装过程" tabindex="-1">安装过程: <a class="header-anchor" href="#安装过程" aria-hidden="true">#</a></h3><h4 id="下载安装" tabindex="-1">下载安装 <a class="header-anchor" href="#下载安装" aria-hidden="true">#</a></h4><p>下载pmm客户端(如有没有外网地址需要把rpm上传到服务器，或放到内网nginx上提供下载) 外网地址</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">cd /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">curl -O http://www.mgf.show/static/download/software/pmm-client-1.16.0-1.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>安装</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">yum install -y pmm-client-1.16.0-1.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="如果主机名重复则需要进行修改-否则跳过" tabindex="-1">如果主机名重复则需要进行修改，否则跳过 <a class="header-anchor" href="#如果主机名重复则需要进行修改-否则跳过" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">hostnamectl set-hostname database02</span></span>
<span class="line"><span style="color:#A6ACCD;">bash</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>说明：database02为主机名</p><h4 id="配置服务端地址" tabindex="-1">配置服务端地址 <a class="header-anchor" href="#配置服务端地址" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#无密码</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin config --server 192.168.26.37:8888</span></span>
<span class="line"><span style="color:#A6ACCD;">#有密码</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin config --server 192.168.26.37:8888 --server-user admin --server-password admin@hhwy</span></span>
<span class="line"><span style="color:#A6ACCD;">#服务端与客户端不再一个网段，需绑定客户端地址 --bind-address ip  --client-address ip</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin config --server 10.20.10.62:8888 --server-user admin --server-password admin@hhwy --bind-address 192.168.63.12 --client-address 192.168.63.12</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="添加监控项-主机" tabindex="-1">添加监控项（主机） <a class="header-anchor" href="#添加监控项-主机" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#42000 是本机客户端和服务端通信端口，hostName 替换成具体服务器的主机名，作为监控名称</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin add linux:metrics  --service-port 42000  hostName  </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="添加主机监控项命令汇总-修改主机名后直接执行即可" tabindex="-1">添加主机监控项命令汇总 修改主机名后直接执行即可 <a class="header-anchor" href="#添加主机监控项命令汇总-修改主机名后直接执行即可" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">hostnamectl set-hostname redis-02 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; pmm-admin config --server 10.0.5.43:8888 --server-user admin --server-password admin@hhwy \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; pmm-admin add linux:metrics  --service-port 42000  redis-02 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; firewall-cmd --zone=public --add-port=42000/tcp --permanent \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; firewall-cmd --zone=public --add-port=42001/tcp --permanent \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; firewall-cmd --reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="添加监控项-mysql" tabindex="-1">添加监控项（mysql） <a class="header-anchor" href="#添加监控项-mysql" aria-hidden="true">#</a></h4><p>如果数据库中无监控用户需要添加数据库用户名及密码，登录mysql 命令行执行以下脚本</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">GRANT ALL PRIVILEGES ON *.* TO &#39;pmm&#39;@&#39;%&#39; IDENTIFIED BY &#39;Hhwy@pmm2018&#39; WITH GRANT OPTION;</span></span>
<span class="line"><span style="color:#A6ACCD;">GRANT ALL PRIVILEGES ON *.* TO &#39;pmm&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;Hhwy@pmm2018&#39; WITH GRANT OPTION;</span></span>
<span class="line"><span style="color:#A6ACCD;">flush privileges;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#10.11.201.69 为数据库IP,10050 为数据库端口，42001 是本机客户端和服务端通信端口，hostName-10050 是服务监控名称， hostName 和端口10050 替换为具体的真实名称</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin add mysql:metrics --user pmm --password Hhwy@pmm2018 --host 192.168.22.5 --port 17081 --service-port 42001 hostName-17081</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="开启防火墙" tabindex="-1">开启防火墙 <a class="header-anchor" href="#开启防火墙" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=42000/tcp --permanent &amp;&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=42001/tcp --permanent &amp;&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="检查客户端状态" tabindex="-1">检查客户端状态 <a class="header-anchor" href="#检查客户端状态" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#检查网络</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin check-network</span></span>
<span class="line"><span style="color:#A6ACCD;">#客户端信息</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin info</span></span>
<span class="line"><span style="color:#A6ACCD;">#服务列表</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin list </span></span>
<span class="line"><span style="color:#A6ACCD;">#ping 服务端</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin ping</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="到服务端检查客户端状态" tabindex="-1">到服务端检查客户端状态 <a class="header-anchor" href="#到服务端检查客户端状态" aria-hidden="true">#</a></h4><p><a href="http://192.168.26.37:8888/prometheus/targets" target="_blank" rel="noreferrer">http://192.168.26.37:8888/prometheus/targets</a></p><h4 id="其他命令" tabindex="-1">其他命令 <a class="header-anchor" href="#其他命令" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">pmm-admin remove linux:metrics 移除一个服务</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin 常用命令介绍</span></span>
<span class="line"><span style="color:#A6ACCD;"># 添加监控服务                            </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin add                             </span></span>
<span class="line"><span style="color:#A6ACCD;"># 检查PMM客户端和PMM服务器之间的网络连接。</span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin check-network                   </span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置PMM Client如何与PMM服务器通信。     </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin config                          </span></span>
<span class="line"><span style="color:#A6ACCD;"># 打印任何命令和退出的帮助                </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin help                            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 打印有关PMM客户端的信息                 </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin info                            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 出为此PMM客户端添加的所有监控服务       </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin list                            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 检查PMM服务器是否存活                   </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin ping                            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 检查PMM服务器是否存活。                 </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin purge                           </span></span>
<span class="line"><span style="color:#A6ACCD;"># 清除PMM服务器上的度量数据               </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin remove, pmm-admin rm            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 删除监控服务                            </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin repair                          </span></span>
<span class="line"><span style="color:#A6ACCD;"># 重启pmm                                 </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin restart                         </span></span>
<span class="line"><span style="color:#A6ACCD;"># 打印PMM Client使用的密码                </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin show-passwords                  </span></span>
<span class="line"><span style="color:#A6ACCD;"># 开启监控服务                            </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin start                           </span></span>
<span class="line"><span style="color:#A6ACCD;"># 停止监控服务                            </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin stop                            </span></span>
<span class="line"><span style="color:#A6ACCD;"># 在卸载之前清理PMM Client                </span></span>
<span class="line"><span style="color:#A6ACCD;">pmm-admin uninstall</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div>`,36),r=[p];function i(c,t,o,m,d,b){return a(),n("div",null,r)}const C=s(l,[["render",i]]);export{u as __pageData,C as default};
