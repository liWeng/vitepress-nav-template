import{_ as s,o as a,c as n,a as e}from"./app.e6daa892.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":3,"title":"软件介绍","slug":"软件介绍","link":"#软件介绍","children":[]},{"level":3,"title":"编写人员","slug":"编写人员","link":"#编写人员","children":[]},{"level":3,"title":"名词解释:","slug":"名词解释","link":"#名词解释","children":[]},{"level":3,"title":"官方文档:","slug":"官方文档","link":"#官方文档","children":[]},{"level":3,"title":"版本要求","slug":"版本要求","link":"#版本要求","children":[]},{"level":3,"title":"安装过程:","slug":"安装过程","link":"#安装过程","children":[]},{"level":3,"title":"下载包","slug":"下载包","link":"#下载包","children":[]}],"relativePath":"articles/deploy/消息队列-kafka集群安装.md","lastUpdated":1697780285000}'),l={name:"articles/deploy/消息队列-kafka集群安装.md"},p=e(`<h3 id="软件介绍" tabindex="-1">软件介绍 <a class="header-anchor" href="#软件介绍" aria-hidden="true">#</a></h3><p>kafka</p><h3 id="编写人员" tabindex="-1">编写人员 <a class="header-anchor" href="#编写人员" aria-hidden="true">#</a></h3><h4 id="特性" tabindex="-1">特性 <a class="header-anchor" href="#特性" aria-hidden="true">#</a></h4><h4 id="局限性" tabindex="-1">局限性 <a class="header-anchor" href="#局限性" aria-hidden="true">#</a></h4><h4 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-hidden="true">#</a></h4><h3 id="名词解释" tabindex="-1">名词解释: <a class="header-anchor" href="#名词解释" aria-hidden="true">#</a></h3><h3 id="官方文档" tabindex="-1">官方文档: <a class="header-anchor" href="#官方文档" aria-hidden="true">#</a></h3><h3 id="版本要求" tabindex="-1">版本要求 <a class="header-anchor" href="#版本要求" aria-hidden="true">#</a></h3><p>版本固定：kafka_2.12-2.4.1</p><h3 id="安装过程" tabindex="-1">安装过程: <a class="header-anchor" href="#安装过程" aria-hidden="true">#</a></h3><ul><li>必须安装java1.8及以上</li><li>必须有zookeeper</li></ul><h3 id="下载包" tabindex="-1">下载包 <a class="header-anchor" href="#下载包" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/kafka</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">cd /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://monitor.mgf.show/static/download/software/kafka_2.12-2.4.1.tgz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar zxvf kafka_2.12-2.4.1.tgz</span></span>
<span class="line"><span style="color:#A6ACCD;">mv kafka_2.12-2.4.1 /usr/local/kafka</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-hidden="true">#</a></h4><h4 id="server-properties" tabindex="-1">server.properties <a class="header-anchor" href="#server-properties" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># The id of the broker. This must be set to a unique integer for each broker.</span></span>
<span class="line"><span style="color:#A6ACCD;">broker.id=31 #集群中此id必须唯一，一般取服务器ip地址最后一个段</span></span>
<span class="line"><span style="color:#A6ACCD;">port=9092    #固定为9092</span></span>
<span class="line"><span style="color:#A6ACCD;">host.name=10.0.1.31  #服务器IP地址</span></span>
<span class="line"><span style="color:#A6ACCD;"># A comma separated list of directories under which to store log files</span></span>
<span class="line"><span style="color:#A6ACCD;">#修改</span></span>
<span class="line"><span style="color:#A6ACCD;">#log.dirs=/data/kafka/logs # 日志地址</span></span>
<span class="line"><span style="color:#A6ACCD;">log.dirs=/data/kafka/log/kafka-topic-logs</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">## 日志清理策略 选择有：delete和compact 主要针对过期数据的处理，或是日志文件达到限制的额度，会被 topic创建时的指定参数覆盖</span></span>
<span class="line"><span style="color:#A6ACCD;">log.cleanup.policy = delete</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">## 数据存储的最大时间 超过这个时间 会根据log.cleanup.policy设置的策略处理数据，也就是消费端能够多久去消费数据</span></span>
<span class="line"><span style="color:#A6ACCD;">## log.retention.bytes和log.retention.minutes任意一个达到要求，都会执行删除，会被topic创建时的指定参数覆盖</span></span>
<span class="line"><span style="color:#A6ACCD;">log.retention.hours=168</span></span>
<span class="line"><span style="color:#A6ACCD;">#修改</span></span>
<span class="line"><span style="color:#A6ACCD;">#zookeeper.connect=zookeeper集群地址 # zookeeper集群地址</span></span>
<span class="line"><span style="color:#A6ACCD;">zookeeper.connect=10.0.1.31:2181,10.0.1.32:2181,10.0.1.33:2181</span></span>
<span class="line"><span style="color:#A6ACCD;">#自动创建topic</span></span>
<span class="line"><span style="color:#A6ACCD;">auto.create.topics.enable=true</span></span>
<span class="line"><span style="color:#A6ACCD;">#允许删除topic</span></span>
<span class="line"><span style="color:#A6ACCD;">delete.topic.enable=true</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">## 一个topic ，默认分区的replication个数 ，不得大于集群中broker的个数</span></span>
<span class="line"><span style="color:#A6ACCD;">default.replication.factor =3</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">## 每个topic的分区个数，若是在topic创建时候没有指定的话 会被topic创建时的指定参数覆盖</span></span>
<span class="line"><span style="color:#A6ACCD;">num.partitions =4</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="修改服务日志位置" tabindex="-1">修改服务日志位置 <a class="header-anchor" href="#修改服务日志位置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">$KAFKA_HOME/bin/kafka-run-class.sh 开头位置加上</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">vi /usr/local/kafka/kafka_2.12-2.4.1/bin/kafka-run-class.sh</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">LOG_DIR=/data/kafka/log/kafka-server-logs</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">vi /usr/local/kafka/kafka_2.12-2.4.1/conf/log4j.properties </span></span>
<span class="line"><span style="color:#A6ACCD;">配置文件里面 TRACE 全部替换为 INFO</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="集群设置" tabindex="-1">集群设置 <a class="header-anchor" href="#集群设置" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">在一台机器上配置完毕server.properties后，分发到集群其他节点上，并修改broker.id</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">1、kafka前台启动</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/local/kafka/kafka_2.12-2.4.1/bin/kafka-server-start.sh /usr/local/kafka/kafka_2.12-2.4.1/config/server.properties</span></span>
<span class="line"><span style="color:#A6ACCD;">2、kafka后台启动，不输出日志</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/local/kafka/kafka_2.12-2.4.1/bin/kafka-server-start.sh -daemon  /usr/local/kafka/kafka_2.12-2.4.1/config/server.properties  </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="创建topic" tabindex="-1">创建topic <a class="header-anchor" href="#创建topic" aria-hidden="true">#</a></h4><ul><li>--replication-factor 　用来设置主题的副本数。每个主题可以有多个副本，副本位于集群中不同的broker上，也就是说副本的数量不能超过broker的数量，否则创建主题时会失败。</li><li>--partitions 分区数，跟消费者数量最好保证一致</li></ul><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">bin/kafka-topics.sh --create --zookeeper zookeeper集群地址 --replication-factor 1 --partitions 1 --topic test</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="生产测试数据" tabindex="-1">生产测试数据 <a class="header-anchor" href="#生产测试数据" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">bin/kafka-console-producer.sh --broker-list kafka节点1:9092,kafka节点2:9092,kafka节点3:9092 --topic USER-OPERATE-AUDIT-SERVICE-TOPIC</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="消费者接收数据测试" tabindex="-1">消费者接收数据测试 <a class="header-anchor" href="#消费者接收数据测试" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">bin/kafka-console-consumer.sh --bootstrap-server kafka节点1:9092,kafka节点2:9092,kafka节点3:9092 --topic USER-OPERATE-AUDIT-SERVICE-TOPIC --from-beginning</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置开机启动</p><p>创建服务启动配置，配置中的jdk版本，以及kafka版本根据实际路径和版本修改</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rm -rf /lib/systemd/system/kafka.service</span></span>
<span class="line"><span style="color:#A6ACCD;">cat &gt;&gt; /lib/systemd/system/kafka.service &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Unit]</span></span>
<span class="line"><span style="color:#A6ACCD;">Description=Kafka 2.12-2.4.1</span></span>
<span class="line"><span style="color:#A6ACCD;">After=network.target  zookeeper.service</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Service]</span></span>
<span class="line"><span style="color:#A6ACCD;">Type=simple</span></span>
<span class="line"><span style="color:#A6ACCD;">Environment=&quot;JAVA_HOME=/usr/local/jdk/jdk1.8.0_172&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">User=root</span></span>
<span class="line"><span style="color:#A6ACCD;">Group=root</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStart=/usr/local/kafka_2.12-2.4.1/bin/kafka-server-start.sh  /usr/local/kafka_2.12-2.4.1/config/server.properties</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStop=/usr/local/kafka_2.12-2.4.1/bin/kafka-server-stop.sh</span></span>
<span class="line"><span style="color:#A6ACCD;">Restart=on-failure</span></span>
<span class="line"><span style="color:#A6ACCD;">LimitNOFILE=65536</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Install]</span></span>
<span class="line"><span style="color:#A6ACCD;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>重新加载服务</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过服务方式启动kafka</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl start kafka</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置开机启动</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl enable kafka</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看kafka状态</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl status kafka</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>出现enabled字样，表名开机启动设置成功</p><h4 id="linux定时任务清理-月初清理上上个月的数据" tabindex="-1">linux定时任务清理 月初清理上上个月的数据 <a class="header-anchor" href="#linux定时任务清理-月初清理上上个月的数据" aria-hidden="true">#</a></h4><div class="language-clear_kafka_logs.sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">clear_kafka_logs.sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rm -rf /usr/local/kafka_2.12-2.4.1/clear_kafka_logs.sh</span></span>
<span class="line"><span style="color:#A6ACCD;">cat &gt;&gt; /usr/local/kafka_2.12-2.4.1/clear_kafka_logs.sh &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#!/bin/sh</span></span>
<span class="line"><span style="color:#A6ACCD;">rm -rf /data/kafka/log/kafka-server-logs/*.log.\`date -d &quot;2 month ago&quot; +%Y-%m\`*;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-配置定时执行 line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">配置定时执行</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">chmod 777 /usr/local/kafka_2.12-2.4.1/clear_kafka_logs.sh</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">crontab -e</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 每月执行一次</span></span>
<span class="line"><span style="color:#A6ACCD;">0 0 1 * * /usr/local/kafka_2.12-2.4.1/clear_kafka_logs.sh</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,45),r=[p];function i(c,o,t,b,d,u){return a(),n("div",null,r)}const m=s(l,[["render",i]]);export{A as __pageData,m as default};
