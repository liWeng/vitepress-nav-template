import{_ as s,o as a,c as n,a as e}from"./app.e6daa892.js";const m=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":3,"title":"软件介绍","slug":"软件介绍","link":"#软件介绍","children":[]},{"level":3,"title":"编写人员","slug":"编写人员","link":"#编写人员","children":[]},{"level":3,"title":"名词解释:","slug":"名词解释","link":"#名词解释","children":[]},{"level":3,"title":"官方文档:","slug":"官方文档","link":"#官方文档","children":[]},{"level":3,"title":"安装过程:","slug":"安装过程","link":"#安装过程","children":[]}],"relativePath":"articles/deploy/中间件-zookeeper-集群安装.md","lastUpdated":1697780285000}'),l={name:"articles/deploy/中间件-zookeeper-集群安装.md"},p=e(`<h3 id="软件介绍" tabindex="-1">软件介绍 <a class="header-anchor" href="#软件介绍" aria-hidden="true">#</a></h3><p>zookeeper 集群安装</p><h3 id="编写人员" tabindex="-1">编写人员 <a class="header-anchor" href="#编写人员" aria-hidden="true">#</a></h3><h4 id="特性" tabindex="-1">特性 <a class="header-anchor" href="#特性" aria-hidden="true">#</a></h4><h4 id="局限性" tabindex="-1">局限性 <a class="header-anchor" href="#局限性" aria-hidden="true">#</a></h4><h4 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-hidden="true">#</a></h4><h3 id="名词解释" tabindex="-1">名词解释: <a class="header-anchor" href="#名词解释" aria-hidden="true">#</a></h3><h3 id="官方文档" tabindex="-1">官方文档: <a class="header-anchor" href="#官方文档" aria-hidden="true">#</a></h3><h3 id="安装过程" tabindex="-1">安装过程: <a class="header-anchor" href="#安装过程" aria-hidden="true">#</a></h3><p>1、jdk配置<br> 注：如果服务器上已有合适版本JDK，可跳过JDK配置 下载JDK</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">cd /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://monitor.mgf.show/static/download/software/jdk-8u261-linux-x64.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar zxvf jdk-8u261-linux-x64.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/java</span></span>
<span class="line"><span style="color:#A6ACCD;">mv jdk1.8.0_261 /usr/local/java</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>配置环境变量</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">vi /etc/profile</span></span>
<span class="line"><span style="color:#A6ACCD;">export JAVA_HOME=/usr/local/java/jdk1.8.0_261</span></span>
<span class="line"><span style="color:#A6ACCD;">export PATH=$JAVA_HOME/bin:$PATH</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">source /etc/profile</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2、下载zookeeper安装包</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">cd /data/software</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://monitor.mgf.show/static/download/software/apache-zookeeper-3.5.8-bin.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar zxvf apache-zookeeper-3.5.8-bin.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;">mv apache-zookeeper-3.5.8-bin /usr/local/zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3、生成配置文件<br> 具体IP根据实际服务器修改</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rm -rf /usr/local/zookeeper/apache-zookeeper-3.5.8-bin/conf/zoo.cfg</span></span>
<span class="line"><span style="color:#A6ACCD;">cat &gt;&gt; /usr/local/zookeeper/apache-zookeeper-3.5.8-bin/conf/zoo.cfg &lt;&lt; EOF</span></span>
<span class="line"><span style="color:#A6ACCD;">tickTime=2000</span></span>
<span class="line"><span style="color:#A6ACCD;">initLimit=10</span></span>
<span class="line"><span style="color:#A6ACCD;">syncLimit=5</span></span>
<span class="line"><span style="color:#A6ACCD;">dataDir=/data/zookeeper/data</span></span>
<span class="line"><span style="color:#A6ACCD;">dataLogDir=/data/zookeeper/logs</span></span>
<span class="line"><span style="color:#A6ACCD;">clientPort=2181</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">server.1=10.0.5.24:8881:7771</span></span>
<span class="line"><span style="color:#A6ACCD;">server.2=10.0.5.25:8881:7771</span></span>
<span class="line"><span style="color:#A6ACCD;">server.3=10.0.5.26:8881:7771</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.purgeInterval=168</span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.snapRetainCount=3</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>配置文件说明</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">tickTime：发送心跳的间隔，单位：毫秒</span></span>
<span class="line"><span style="color:#A6ACCD;">dataDir：zookeeper保存数据的位置。</span></span>
<span class="line"><span style="color:#A6ACCD;">clientPort：客户端连接 Zookeeper 服务器的端口</span></span>
<span class="line"><span style="color:#A6ACCD;">syncLimit：这个配置项标识 Leader 与 Follower 之间发送消息，请求和应答时间长度，最长不能超过多少个 tickTime 的时间长度，总的时间长度就是 2*2000=4 秒</span></span>
<span class="line"><span style="color:#A6ACCD;">server.A=B：C：D：其中 A 是一个数字，表示这个是第几号服务器；B 是这个服务器的 ip 地址；C 表示的是这个服务器与集群中的 Leader 服务器交换信息的端口；D 表示的是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的 Leader，而这个端口就是用来执行选举时服务器相互通信的端口。如果是伪集群的配置方式，由于 B 都是一样，所以不同的 Zookeeper 实例通信端口号不能一样，所以要给它们分配不同的端口号。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.purgeInterval： 这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。</span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.snapRetainCount：这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>创建myid文件在每一个data下面创建一个myid文件(myid没有扩展名) 里边的内容是 server.X=localhost:8881:7771 中配置的X，例如第一个就是1，第二个就是2配置参数解释</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">cd /data/zookeeper/data</span></span>
<span class="line"><span style="color:#A6ACCD;">echo 1 &gt; myid</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4、创建文件夹</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /data/zookeeper/data</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p /data/zookeeper/logs</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>5、开放防火墙端口<br> 如果防火墙未启用，可不做设置</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=2181/tcp --permanent </span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=7771/tcp --permanent </span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=8881/tcp --permanent </span></span>
<span class="line"><span style="color:#A6ACCD;">firewall-cmd --reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>6、设置开机启动</p><p>创建服务启动配置，配置中的jdk版本，以及zookeeper版本根据实际路径和版本修改</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rm -rf /lib/systemd/system/zookeeper.service</span></span>
<span class="line"><span style="color:#A6ACCD;">cat &gt;&gt; /lib/systemd/system/zookeeper.service &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Unit]</span></span>
<span class="line"><span style="color:#A6ACCD;">Description=Apache Zookeeper 3.5.8</span></span>
<span class="line"><span style="color:#A6ACCD;">After=network.target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Service]</span></span>
<span class="line"><span style="color:#A6ACCD;">Type=forking</span></span>
<span class="line"><span style="color:#A6ACCD;">Environment=&quot;JAVA_HOME=/usr/local/java/jdk1.8.0_261&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStart=/usr/local/zookeeper/bin/zkServer.sh start</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecReload=/usr/local/zookeeper/bin/zkServer.sh restart</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStop=/usr/local/zookeeper/bin/zkServer.sh stop</span></span>
<span class="line"><span style="color:#A6ACCD;">PrivateTmp=true</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[Install]</span></span>
<span class="line"><span style="color:#A6ACCD;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>重新加载服务</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过服务方式启动zookeeper</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl start zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置开机启动</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl enable zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看zookeeper状态</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">systemctl status zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>出现enabled字样，表名开机启动设置成功</p><h4 id="修改服务日志位置" tabindex="-1">修改服务日志位置 <a class="header-anchor" href="#修改服务日志位置" aria-hidden="true">#</a></h4><p>位置：/usr/local/zookeeper/bin/zkEnv.sh</p><div class="language-启动应用日志配置 line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">启动应用日志配置</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">#增加配置在第一行</span></span>
<span class="line"><span style="color:#A6ACCD;">ZOO_LOG_DIR=/data/zookeeper/log/zookeeper-server-logs</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>位置：/usr/local/zookeeper/conf/zoo.cfg</p><div class="language-应用数据日志配置 line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">应用数据日志配置</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># 检查应用运行数据日志存放位置</span></span>
<span class="line"><span style="color:#A6ACCD;">dataLogDir=/data/zookeeper/log/zookeeper-data-logs</span></span>
<span class="line"><span style="color:#A6ACCD;">#增加日志定期删除处理</span></span>
<span class="line"><span style="color:#A6ACCD;"># 设置清除时间</span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.purgeInterval=48</span></span>
<span class="line"><span style="color:#A6ACCD;"># 保留个数</span></span>
<span class="line"><span style="color:#A6ACCD;">autopurge.snapRetainCount=2</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-log4j.properties line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">log4j.properties</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># 滚动记录日志设置</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="题外" tabindex="-1">题外 <a class="header-anchor" href="#题外" aria-hidden="true">#</a></h4><p>如果不需要配置服务方式启动，临时启动使用如下命令，如果已经配置了服务方式启动，则不再使用命令启动 命令启动</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">/usr/local/zookeeper/apache-zookeeper-3.5.8-bin/bin/zkServer.sh start</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,46),r=[p];function i(c,o,t,b,d,u){return a(),n("div",null,r)}const A=s(l,[["render",i]]);export{m as __pageData,A as default};
